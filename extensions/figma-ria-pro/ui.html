<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RIA Cognitive Design Enhancer</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 12px;
      background: #f8f9fa;
      color: #1a1a1a;
      padding: 16px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e1e5e9;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .version {
      font-size: 10px;
      color: #666;
    }
    
    .status-card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-dot.active { background: #22c55e; }
    .status-dot.inactive { background: #ef4444; }
    
    .fi-display {
      text-align: center;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
      color: white;
      margin-bottom: 16px;
    }
    
    .fi-value {
      font-size: 28px;
      font-weight: 700;
      line-height: 1;
    }
    
    .fi-label {
      font-size: 10px;
      opacity: 0.8;
      margin-top: 4px;
    }
    
    .metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .metric {
      background: white;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .metric-value {
      font-size: 16px;
      font-weight: 600;
      color: #4f46e5;
    }
    
    .metric-label {
      font-size: 9px;
      color: #666;
      margin-top: 2px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: #4f46e5;
      color: white;
    }
    
    .btn-primary:hover {
      background: #4338ca;
    }
    
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }
    
    .btn-secondary:hover {
      background: #d1d5db;
    }
    
    .interventions {
      margin-top: 16px;
    }
    
    .intervention {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 8px;
    }
    
    .intervention-title {
      font-weight: 600;
      font-size: 11px;
      color: #92400e;
      margin-bottom: 4px;
    }
    
    .intervention-message {
      font-size: 10px;
      color: #78350f;
      margin-bottom: 8px;
    }
    
    .intervention-actions {
      display: flex;
      gap: 4px;
    }
    
    .btn-intervention {
      padding: 4px 8px;
      font-size: 9px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #f59e0b;
      color: white;
    }
    
    .btn-intervention:hover {
      background: #d97706;
    }
    
    .insights {
      background: white;
      border-radius: 8px;
      padding: 12px;
      font-size: 10px;
      color: #666;
    }
    
    .insight-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      padding-bottom: 6px;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .insight-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .hidden {
      display: none;
    }
    
    .enhancement-badges {
      display: flex;
      gap: 4px;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    
    .badge {
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 8px;
      font-weight: 500;
    }
    
    .badge-generative {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .badge-resonance {
      background: #fce7f3;
      color: #be185d;
    }
    
    .badge-antifragile {
      background: #d1fae5;
      color: #065f46;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">ðŸ§  RIA Design Enhancer</div>
    <div class="version">v2.1.0 - Cognitive Design Assistant</div>
  </div>

  <div class="status-card">
    <div class="status-indicator">
      <div style="display: flex; align-items: center;">
        <div id="statusDot" class="status-dot inactive"></div>
        <span id="statusText">Inactive</span>
      </div>
      <span id="sessionTime">00:00</span>
    </div>
    
    <div class="enhancement-badges">
      <span class="badge badge-generative">ðŸ§  Generative</span>
      <span class="badge badge-resonance">ðŸŽµ Resonance</span>
      <span class="badge badge-antifragile">ðŸ§¬ Antifragile</span>
    </div>
  </div>

  <div class="fi-display">
    <div id="fiValue" class="fi-value">0.00</div>
    <div class="fi-label">FRACTURE INDEX</div>
  </div>

  <div class="metrics">
    <div class="metric">
      <div id="complexityValue" class="metric-value">0%</div>
      <div class="metric-label">COMPLEXITY</div>
    </div>
    <div class="metric">
      <div id="interventionsValue" class="metric-value">0</div>
      <div class="metric-label">INTERVENTIONS</div>
    </div>
  </div>

  <div class="controls">
    <button id="startBtn" class="btn btn-primary">Start Monitoring</button>
    <button id="stopBtn" class="btn btn-secondary hidden">Stop</button>
  </div>

  <div id="interventionsContainer" class="interventions hidden">
    <!-- Interventions will be dynamically added here -->
  </div>

  <div class="insights">
    <div class="insight-item">
      <span>Design Context:</span>
      <span id="contextValue">Unknown</span>
    </div>
    <div class="insight-item">
      <span>Selection Count:</span>
      <span id="selectionValue">0</span>
    </div>
    <div class="insight-item">
      <span>Session Duration:</span>
      <span id="durationValue">0s</span>
    </div>
  </div>

  <script>
    // UI State Management
    let isActive = false;
    let sessionStartTime = 0;
    let currentFI = 0;
    let interventions = [];

    // DOM Elements
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const sessionTime = document.getElementById('sessionTime');
    const fiValue = document.getElementById('fiValue');
    const complexityValue = document.getElementById('complexityValue');
    const interventionsValue = document.getElementById('interventionsValue');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const interventionsContainer = document.getElementById('interventionsContainer');
    const contextValue = document.getElementById('contextValue');
    const selectionValue = document.getElementById('selectionValue');
    const durationValue = document.getElementById('durationValue');

    // Event Listeners
    startBtn.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'start' } }, '*');
    });

    stopBtn.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'stop' } }, '*');
    });

    // Message Handler
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      
      switch (message.type) {
        case 'init':
          updateVersion(message.data.version);
          break;
        case 'status-update':
          updateStatus(message.data);
          break;
        case 'analysis-update':
          updateAnalysis(message.data);
          break;
        case 'context-update':
          updateContext(message.data);
          break;
        case 'interventions':
          displayInterventions(message.data);
          break;
        case 'periodic-update':
          updatePeriodic(message.data);
          break;
      }
    };

    function updateVersion(version) {
      document.querySelector('.version').textContent = `v${version} - Cognitive Design Assistant`;
    }

    function updateStatus(data) {
      isActive = data.active;
      currentFI = data.fi || 0;
      
      if (isActive) {
        statusDot.className = 'status-dot active';
        statusText.textContent = 'Active';
        startBtn.classList.add('hidden');
        stopBtn.classList.remove('hidden');
        sessionStartTime = Date.now();
        startSessionTimer();
      } else {
        statusDot.className = 'status-dot inactive';
        statusText.textContent = 'Inactive';
        startBtn.classList.remove('hidden');
        stopBtn.classList.add('hidden');
        interventionsContainer.classList.add('hidden');
      }
      
      updateFI(currentFI);
    }

    function updateAnalysis(data) {
      updateFI(data.fi);
      complexityValue.textContent = Math.round(data.complexity * 100) + '%';
      selectionValue.textContent = data.selectionCount || 0;
      
      // Add visual feedback for high FI
      if (data.fi > 0.7) {
        fiValue.parentElement.classList.add('pulse');
      } else {
        fiValue.parentElement.classList.remove('pulse');
      }
    }

    function updateContext(data) {
      contextValue.textContent = data.context || 'Unknown';
    }

    function updatePeriodic(data) {
      updateFI(data.fi);
      durationValue.textContent = Math.round(data.sessionDuration / 1000) + 's';
    }

    function updateFI(fi) {
      currentFI = fi;
      fiValue.textContent = fi.toFixed(2);
      
      // Color coding based on FI level
      const fiDisplay = fiValue.parentElement;
      if (fi < 0.3) {
        fiDisplay.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
      } else if (fi < 0.6) {
        fiDisplay.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
      } else if (fi < 0.8) {
        fiDisplay.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
      } else {
        fiDisplay.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
      }
    }

    function displayInterventions(interventionList) {
      interventions = interventionList;
      interventionsValue.textContent = interventions.length;
      
      if (interventions.length > 0) {
        interventionsContainer.classList.remove('hidden');
        interventionsContainer.innerHTML = '';
        
        interventions.forEach((intervention, index) => {
          const div = document.createElement('div');
          div.className = 'intervention';
          div.innerHTML = `
            <div class="intervention-title">${intervention.title}</div>
            <div class="intervention-message">${intervention.message}</div>
            <div class="intervention-actions">
              <button class="btn-intervention" onclick="applyIntervention(${index})">Apply</button>
              <button class="btn-intervention" onclick="dismissIntervention(${index})">Dismiss</button>
            </div>
          `;
          interventionsContainer.appendChild(div);
        });
      } else {
        interventionsContainer.classList.add('hidden');
      }
    }

    function applyIntervention(index) {
      const intervention = interventions[index];
      parent.postMessage({ 
        pluginMessage: { 
          type: 'apply-intervention', 
          intervention: intervention 
        } 
      }, '*');
      dismissIntervention(index);
    }

    function dismissIntervention(index) {
      interventions.splice(index, 1);
      displayInterventions(interventions);
    }

    function startSessionTimer() {
      setInterval(() => {
        if (!isActive) return;
        
        const elapsed = Date.now() - sessionStartTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        sessionTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    // Request initial status
    parent.postMessage({ pluginMessage: { type: 'get-status' } }, '*');
  </script>
</body>
</html>